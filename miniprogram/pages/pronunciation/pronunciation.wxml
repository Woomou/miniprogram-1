<!-- 基于参考设计的现代化拼读学习页面 -->
<view class="app-container">
  <!-- 顶部渐变 AppBar -->
  <view class="app-bar">
    <view class="app-bar-content">
      <view class="app-bar-left">
        <view class="icon-button" bindtap="goBack">
          <text class="icon">←</text>
        </view>
      </view>
      <view class="app-bar-title">
        <text class="title-text">拼读练习</text>
      </view>
      <view class="app-bar-right"></view>
    </view>
  </view>

  <!-- 主滚动容器 -->
  <scroll-view class="main-scroll" scroll-y="true">
    
    <!-- 单词选择 chips (横向滑动) -->
    <view class="section word-chips-section">
      <scroll-view class="word-chips-scroll" scroll-x="true" show-scrollbar="false">
        <view class="chip-row">
          <view 
            class="word-chip {{selectedWordIndex === index ? 'active' : ''}}" 
            wx:for="{{wordList}}" 
            wx:key="id"
            wx:for-index="index"
            data-index="{{index}}"
            bindtap="selectWordChip"
          >
            <text class="chip-text">{{item.word}}</text>
            <view class="chip-difficulty difficulty-{{item.difficulty}}"></view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 学习步骤 Tabs -->
    <view class="section tabs-section">
      <view class="step-tabs">
        <view 
          class="tab-item {{activeTab === item.key ? 'active' : ''}} {{item.disabled ? 'disabled' : ''}}" 
          wx:for="{{stepTabs}}" 
          wx:key="key"
          data-key="{{item.key}}"
          bindtap="switchTab"
        >
          <text class="tab-label">{{item.label}}</text>
        </view>
      </view>
    </view>

    <!-- 主词卡 -->
    <view class="section" wx:if="{{currentWord.word}}">
      <view class="main-word-card">
        
        <!-- 单词标题 -->
        <view class="word-title-section">
          <text class="word-title">{{currentWord.word}}</text>
        </view>

        <!-- 组合提示chips（如果是复合词） -->
        <view class="compose-hints" wx:if="{{wordParts.length > 0}}">
          <view class="hint-chip" wx:for="{{wordParts}}" wx:key="*this">
            <text class="hint-text">{{item}}</text>
          </view>
        </view>

        <!-- 音标和发音按钮 -->
        <view class="ipa-row">
          <text class="phonetic-text">/{{currentWord.phonetic}}/</text>
          <view class="play-button" bindtap="playWordAudio">
            <text class="play-icon">🔊</text>
          </view>
        </view>

        <!-- 词性和词义 -->
        <view class="meaning-row">
          <text class="word-type">n.</text>
          <text class="word-meaning">{{currentWord.meaning}}</text>
          <text class="detail-link" bindtap="showDetail">详解</text>
        </view>

        <!-- 音素分析 chips -->
        <view class="phoneme-section">
          <view class="phoneme-chips">
            <view class="phoneme-chip" wx:for="{{phonemeList}}" wx:key="*this">
              <text class="phoneme-text">{{item}}</text>
            </view>
          </view>
        </view>

        <!-- 拼读功能按钮 -->
        <view class="action-buttons">
          <view 
            class="action-btn {{readingMode === 'phonics' ? 'active' : 'outline'}}" 
            bindtap="switchReadingMode"
            data-mode="phonics"
          >
            <text class="btn-text">自然拼读</text>
          </view>
          <view 
            class="action-btn {{readingMode === 'syllable' ? 'active' : 'outline'}}" 
            bindtap="switchReadingMode"
            data-mode="syllable"
          >
            <text class="btn-text">音节拆分</text>
          </view>
          <view 
            class="action-btn outline" 
            bindtap="goToHandwriting"
          >
            <text class="btn-text">手写单词</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 词根助记卡片 -->
    <view class="section" wx:if="{{currentWord.word && wordParts.length > 0}}">
      <view class="mnemonic-card">
        <view class="mnemonic-badge">
          <text class="badge-text">词根助记</text>
        </view>
        
        <view class="mnemonic-content">
          <view class="word-equation">
            <view class="equation-item" wx:for="{{wordParts}}" wx:key="*this">
              <view class="root-token">
                <text class="root-text">{{item}}</text>
                <text class="root-meaning">{{mnemonicMeanings[item] || ''}}</text>
              </view>
              <text class="equation-operator" wx:if="{{index < wordParts.length - 1}}">+</text>
            </view>
            <text class="equation-operator">=</text>
            <view class="result-token">
              <text class="result-text">{{currentWord.word}}</text>
            </view>
          </view>
          <view class="mnemonic-explanation">
            <text class="explanation-text">{{mnemonicExplanation}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 拼读分析卡片 -->
    <view class="section" wx:if="{{currentWord.word && readingAnalysis}}">
      <view class="analysis-card">
        <view class="analysis-badge">
          <text class="badge-text">{{readingMode === 'phonics' ? '自然拼读分析' : '音节拆分分析'}}</text>
        </view>
        
        <view class="analysis-content">
          <!-- 单词拆分切片（可交互的按钮列表） -->
          <view class="word-parts-section">
            <view class="section-title">
              <text class="title-text">单词拆分</text>
            </view>
            <view class="word-parts-list">
              <view 
                class="word-part-item interactive" 
                wx:for="{{wordParts}}" 
                wx:key="index"
                wx:for-index="index"
                data-part="{{item}}"
                data-index="{{index}}"
                bindtap="playWordPartAudio"
              >
                <text class="part-text">{{item}}</text>
                <view class="play-icon">🔊</view>
              </view>
            </view>
          </view>
          
          <!-- 音素拆分切片（只显示，不可交互） -->
          <view class="phoneme-parts-section">
            <view class="section-title">
              <text class="title-text">音素拆分</text>
            </view>
            <view class="phoneme-parts-list">
              <view 
                class="phoneme-part-item" 
                wx:for="{{phonemeList}}" 
                wx:key="index"
                wx:for-index="index"
              >
                <text class="phoneme-text">{{item}}</text>
              </view>
            </view>
          </view>
          
          <!-- 自然拼读模式 -->
          <view wx:if="{{readingMode === 'phonics'}}">
            <view class="section-title">
              <text class="title-text">🔤 自然拼读分析</text>
              <text class="subtitle-text">字母与发音的对应关系</text>
            </view>
            <view class="phonics-breakdown">
              <view 
                class="phonics-item interactive" 
                wx:for="{{readingAnalysis.phonics}}" 
                wx:key="letters"
                wx:for-index="index"
                data-syllable="{{item.letters}}"
                data-index="{{index}}"
                bindtap="recordSyllable"
              >
                <view class="phonics-content">
                  <text class="letter-part">{{item.letters}}</text>
                  <text class="arrow">→</text>
                  <text class="sound-part">{{item.sound}}</text>
                </view>
                <view class="phonics-description" wx:if="{{item.description}}">
                  <text class="desc-text">{{item.description}}</text>
                </view>
                <view class="record-indicator" wx:if="{{recordingSyllableIndex === index}}">🎤</view>
              </view>
            </view>
            
            <!-- 音节块显示（如果有的话） -->
            <view class="syllable-blocks" wx:if="{{readingAnalysis.syllableBlocks}}">
              <view class="section-title">
                <text class="title-text">🎵 音节结构</text>
                <text class="subtitle-text">重音和节奏</text>
              </view>
              <view class="blocks-container">
                <view 
                  class="syllable-block stress-{{item.stress}}"
                  wx:for="{{readingAnalysis.syllableBlocks}}" 
                  wx:key="letters_span"
                >
                  <text class="block-letters">{{item.letters_span}}</text>
                  <text class="block-ipa">{{item.ipa}}</text>
                  <text class="stress-indicator" wx:if="{{item.stress > 0}}">{{item.stress === 1 ? 'ˈ' : 'ˌ'}}</text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- 音节拆分模式 -->
          <view wx:if="{{readingMode === 'syllable'}}">
            <view class="section-title">
              <text class="title-text">🎵 音节拆分分析</text>
              <text class="subtitle-text">单词的节拍和韵律</text>
            </view>
            
            <!-- ARPA音节显示 -->
            <view class="syllable-breakdown">
              <view class="breakdown-header">
                <text class="header-text">ARPA音节</text>
              </view>
              <view 
                class="syllable-item arpa interactive" 
                wx:for="{{readingAnalysis.syllables}}" 
                wx:key="index"
                wx:for-index="index"
                data-syllable="{{item}}"
                data-index="{{index}}"
                bindtap="recordSyllable"
              >
                <text class="syllable-text">{{item}}</text>
                <view class="record-indicator" wx:if="{{recordingSyllableIndex === index}}">🎤</view>
              </view>
            </view>
            
            <!-- IPA音节显示 -->
            <view class="ipa-breakdown" wx:if="{{readingAnalysis.ipa}}">
              <view class="breakdown-header">
                <text class="header-text">IPA音节</text>
              </view>
              <view 
                class="syllable-item ipa" 
                wx:for="{{readingAnalysis.ipa}}" 
                wx:key="index"
              >
                <text class="ipa-text">{{item}}</text>
              </view>
            </view>
            
            <!-- 重音模式显示 -->
            <view class="stress-breakdown" wx:if="{{readingAnalysis.stressedSyllables}}">
              <view class="breakdown-header">
                <text class="header-text">重音标记</text>
              </view>
              <view class="stress-container">
                <view 
                  class="stress-syllable"
                  wx:for="{{readingAnalysis.stressedSyllables}}" 
                  wx:key="index"
                >
                  <view 
                    class="stress-phoneme level-{{phoneme.level}}"
                    wx:for="{{item}}"
                    wx:for-item="phoneme"
                    wx:key="sub"
                  >
                    <text class="phoneme-text">{{phoneme.sub}}</text>
                    <text class="stress-mark" wx:if="{{phoneme.level === 1}}">ˈ</text>
                    <text class="stress-mark" wx:if="{{phoneme.level === 2}}">ˌ</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <view class="analysis-tips">
          <text class="tips-text">{{readingAnalysis.tips}}</text>
        </view>
      </view>
    </view>

    <!-- 录音测试卡片 -->
    <view class="section" wx:if="{{currentWord.word && activeTab === 'read'}}">
      <view class="recording-card">
        <view class="recording-badge">
          <text class="badge-text">发音测试</text>
        </view>
        
        <!-- 录音按钮 -->
        <view class="recording-section">
          <view class="microphone-container">
            <view 
              class="microphone-btn {{isRecording ? 'recording' : ''}}" 
              bindtap="toggleRecording"
            >
              <view class="mic-icon">
                <text class="mic-text">{{isRecording ? '⏹' : '🎤'}}</text>
              </view>
              <text class="mic-label">{{isRecording ? '录音中...' : '点击录音'}}</text>
            </view>
          </view>
        </view>

        <!-- 录音结果分析 -->
        <view class="result-analysis" wx:if="{{recognitionResult}}">
          <view class="result-title">
            <text class="title-text">识别分析</text>
          </view>
          
          <view class="word-comparison">
            <view class="comparison-item original">
              <text class="item-label">目标单词</text>
              <text class="item-word">{{currentWord.word}}</text>
            </view>
            <view class="comparison-arrow">
              <text class="arrow-text">→</text>
            </view>
            <view class="comparison-item recognized">
              <text class="item-label">识别结果</text>
              <text class="item-word">{{recognitionResult}}</text>
            </view>
          </view>

          <!-- 准确度显示 -->
          <view class="accuracy-display">
            <view class="accuracy-bar-container">
              <view class="accuracy-bar">
                <view class="accuracy-fill" style="width: {{accuracyScore}}%"></view>
              </view>
            </view>
            <text class="accuracy-score">{{accuracyScore}}%</text>
          </view>

          <!-- 发音反馈 -->
          <view class="feedback-section" wx:if="{{feedback}}">
            <text class="feedback-title">改进建议</text>
            <text class="feedback-content">{{feedback}}</text>
          </view>

          <!-- 重试按钮 -->
          <view class="retry-section">
            <view class="retry-btn" bindtap="retryTest">
              <text class="retry-text">重新测试</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 实用口语卡片 -->
    <view class="section" wx:if="{{currentWord.word && usageExample}}">
      <view class="usage-card">
        <view class="usage-badge">
          <text class="badge-text">实用口语</text>
        </view>
        <view class="usage-content">
          <rich-text class="usage-text" nodes="{{usageExample}}"></rich-text>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{!currentWord.word}}">
      <text class="empty-text">选择一个单词开始学习</text>
    </view>

    <!-- 底部间距 -->
    <view class="bottom-spacing"></view>
  </scroll-view>
</view> 
