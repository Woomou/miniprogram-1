<!-- åŸºäºå‚è€ƒè®¾è®¡çš„ç°ä»£åŒ–æ‹¼è¯»å­¦ä¹ é¡µé¢ -->
<view class="app-container">
  <!-- é¡¶éƒ¨æ¸å˜ AppBar -->
  <view class="app-bar">
    <view class="app-bar-content">
      <view class="app-bar-left">
        <view class="icon-button" bindtap="goBack">
          <text class="icon">â†</text>
        </view>
      </view>
      <view class="app-bar-title">
        <text class="title-text">æ‹¼è¯»ç»ƒä¹ </text>
      </view>
      <view class="app-bar-right"></view>
    </view>
  </view>

  <!-- ä¸»æ»šåŠ¨å®¹å™¨ -->
  <scroll-view class="main-scroll" scroll-y="true">
    
    <!-- å•è¯é€‰æ‹© chips -->
    <view class="section word-chips-section">
      <view class="chip-row">
        <view 
          class="word-chip {{selectedWordIndex === index ? 'active' : ''}}" 
          wx:for="{{wordList}}" 
          wx:key="id"
          wx:for-index="index"
          data-index="{{index}}"
          bindtap="selectWordChip"
        >
          <text class="chip-text">{{item.word}}</text>
          <view class="chip-difficulty difficulty-{{item.difficulty}}"></view>
        </view>
      </view>
    </view>

    <!-- å­¦ä¹ æ­¥éª¤ Tabs -->
    <view class="section tabs-section">
      <view class="step-tabs">
        <view 
          class="tab-item {{activeTab === item.key ? 'active' : ''}} {{item.disabled ? 'disabled' : ''}}" 
          wx:for="{{stepTabs}}" 
          wx:key="key"
          data-key="{{item.key}}"
          bindtap="switchTab"
        >
          <text class="tab-label">{{item.label}}</text>
        </view>
      </view>
    </view>

    <!-- ä¸»è¯å¡ -->
    <view class="section" wx:if="{{currentWord.word}}">
      <view class="main-word-card">
        
        <!-- å•è¯æ ‡é¢˜ -->
        <view class="word-title-section">
          <text class="word-title">{{currentWord.word}}</text>
        </view>

        <!-- ç»„åˆæç¤ºchipsï¼ˆå¦‚æœæ˜¯å¤åˆè¯ï¼‰ -->
        <view class="compose-hints" wx:if="{{wordParts.length > 0}}">
          <view class="hint-chip" wx:for="{{wordParts}}" wx:key="*this">
            <text class="hint-text">{{item}}</text>
          </view>
        </view>

        <!-- éŸ³æ ‡å’Œå‘éŸ³æŒ‰é’® -->
        <view class="ipa-row">
          <text class="phonetic-text">/{{currentWord.phonetic}}/</text>
          <view class="play-button" bindtap="playWordAudio">
            <text class="play-icon">ğŸ”Š</text>
          </view>
        </view>

        <!-- è¯æ€§å’Œè¯ä¹‰ -->
        <view class="meaning-row">
          <text class="word-type">n.</text>
          <text class="word-meaning">{{currentWord.meaning}}</text>
          <text class="detail-link" bindtap="showDetail">è¯¦è§£</text>
        </view>

        <!-- éŸ³ç´ åˆ†æ chips -->
        <view class="phoneme-section">
          <view class="phoneme-chips">
            <view class="phoneme-chip" wx:for="{{phonemeList}}" wx:key="*this">
              <text class="phoneme-text">{{item}}</text>
            </view>
          </view>
        </view>

        <!-- æ‹¼è¯»åŠŸèƒ½æŒ‰é’® -->
        <view class="action-buttons">
          <view 
            class="action-btn {{readingMode === 'phonics' ? 'active' : 'outline'}}" 
            bindtap="switchReadingMode"
            data-mode="phonics"
          >
            <text class="btn-text">è‡ªç„¶æ‹¼è¯»</text>
          </view>
          <view 
            class="action-btn {{readingMode === 'syllable' ? 'active' : 'outline'}}" 
            bindtap="switchReadingMode"
            data-mode="syllable"
          >
            <text class="btn-text">éŸ³èŠ‚æ‹†åˆ†</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ‹¼è¯»åˆ†æå¡ç‰‡ -->
    <view class="section" wx:if="{{currentWord.word && readingAnalysis}}">
      <view class="analysis-card">
        <view class="analysis-badge">
          <text class="badge-text">{{readingMode === 'phonics' ? 'è‡ªç„¶æ‹¼è¯»åˆ†æ' : 'éŸ³èŠ‚æ‹†åˆ†åˆ†æ'}}</text>
        </view>
        
        <view class="analysis-content">
          <!-- è‡ªç„¶æ‹¼è¯»æ¨¡å¼ -->
          <view wx:if="{{readingMode === 'phonics'}}">
            <view class="phonics-breakdown">
              <view class="phonics-item" wx:for="{{readingAnalysis.phonics}}" wx:key="*this">
                <text class="letter-part">{{item.letters}}</text>
                <text class="sound-part">{{item.sound}}</text>
              </view>
            </view>
          </view>
          
          <!-- éŸ³èŠ‚æ‹†åˆ†æ¨¡å¼ -->
          <view wx:if="{{readingMode === 'syllable'}}">
            <view class="syllable-breakdown">
              <view class="syllable-item" wx:for="{{readingAnalysis.syllables}}" wx:key="*this">
                <text class="syllable-text">{{item}}</text>
              </view>
            </view>
          </view>
        </view>
        
        <view class="analysis-tips">
          <text class="tips-text">{{readingAnalysis.tips}}</text>
        </view>
      </view>
    </view>

    <!-- å½•éŸ³æµ‹è¯•å¡ç‰‡ -->
    <view class="section" wx:if="{{currentWord.word && activeTab === 'read'}}">
      <view class="recording-card">
        <view class="recording-badge">
          <text class="badge-text">å‘éŸ³æµ‹è¯•</text>
        </view>
        
        <!-- å½•éŸ³æŒ‰é’® -->
        <view class="recording-section">
          <view class="microphone-container">
            <view 
              class="microphone-btn {{isRecording ? 'recording' : ''}}" 
              bindtap="toggleRecording"
            >
              <view class="mic-icon">
                <text class="mic-text">{{isRecording ? 'â¹' : 'ğŸ¤'}}</text>
              </view>
              <text class="mic-label">{{isRecording ? 'å½•éŸ³ä¸­...' : 'ç‚¹å‡»å½•éŸ³'}}</text>
            </view>
          </view>
        </view>

        <!-- å½•éŸ³ç»“æœåˆ†æ -->
        <view class="result-analysis" wx:if="{{recognitionResult}}">
          <view class="result-title">
            <text class="title-text">è¯†åˆ«åˆ†æ</text>
          </view>
          
          <view class="word-comparison">
            <view class="comparison-item original">
              <text class="item-label">ç›®æ ‡å•è¯</text>
              <text class="item-word">{{currentWord.word}}</text>
            </view>
            <view class="comparison-arrow">
              <text class="arrow-text">â†’</text>
            </view>
            <view class="comparison-item recognized">
              <text class="item-label">è¯†åˆ«ç»“æœ</text>
              <text class="item-word">{{recognitionResult}}</text>
            </view>
          </view>

          <!-- å‡†ç¡®åº¦æ˜¾ç¤º -->
          <view class="accuracy-display">
            <view class="accuracy-bar-container">
              <view class="accuracy-bar">
                <view class="accuracy-fill" style="width: {{accuracyScore}}%"></view>
              </view>
            </view>
            <text class="accuracy-score">{{accuracyScore}}%</text>
          </view>

          <!-- å‘éŸ³åé¦ˆ -->
          <view class="feedback-section" wx:if="{{feedback}}">
            <text class="feedback-title">æ”¹è¿›å»ºè®®</text>
            <text class="feedback-content">{{feedback}}</text>
          </view>

          <!-- é‡è¯•æŒ‰é’® -->
          <view class="retry-section">
            <view class="retry-btn" bindtap="retryTest">
              <text class="retry-text">é‡æ–°æµ‹è¯•</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å®ç”¨å£è¯­å¡ç‰‡ -->
    <view class="section" wx:if="{{currentWord.word && usageExample}}">
      <view class="usage-card">
        <view class="usage-badge">
          <text class="badge-text">å®ç”¨å£è¯­</text>
        </view>
        <view class="usage-content">
          <rich-text class="usage-text" nodes="{{usageExample}}"></rich-text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!currentWord.word}}">
      <text class="empty-text">é€‰æ‹©ä¸€ä¸ªå•è¯å¼€å§‹å­¦ä¹ </text>
    </view>

    <!-- åº•éƒ¨é—´è· -->
    <view class="bottom-spacing"></view>
  </scroll-view>
</view> 